
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Visualization of steady model results with particle tracking</title><meta name="generator" content="MATLAB 7.13"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2013-06-15"><meta name="DC.source" content="mf_analyze.m"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h1>Visualization of steady model results with particle tracking</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Closing existing graphs and variables</a></li><li><a href="#2">The options and steps will be outlined here</a></li><li><a href="#3">First step: retrieve the basename of this model</a></li><li><a href="#4">Get the heads and the budget info.</a></li><li><a href="#5">Ways to show the data</a></li><li><a href="#6">Show zoneBudget</a></li><li><a href="#7">Plotting conductivities in a cross section along x-axis</a></li><li><a href="#8">Plotting conductivities in a cross section along y-axis</a></li><li><a href="#9">Plotting stream function</a></li><li><a href="#10">Plotting head contours of all layers</a></li><li><a href="#12">Show the particles generated by MODPATH</a></li><li><a href="#13">Look at the endpoints of the particles tracked</a></li><li><a href="#14">Look at the strating points of the particles tracked</a></li><li><a href="#15">Plot path lines</a></li><li><a href="#16">TO 130614</a></li></ul></div><h2>Closing existing graphs and variables<a name="1"></a></h2><pre class="codeinput">close <span class="string">all</span>;
clear <span class="string">variables</span>;
</pre><h2>The options and steps will be outlined here<a name="2"></a></h2><p>Notice that there are many more visualization options. One of them are animations and video's that are generally used in combation with transient flow and with mass transport simulations. Here we only have a steady-steate model.</p><h2>First step: retrieve the basename of this model<a name="3"></a></h2><pre class="codeinput">load <span class="string">name</span>       <span class="comment">% retrieve basename stored in file name.mat</span>
load(basename)  <span class="comment">% get model arrays that were saved by mf_setup</span>
</pre><h2>Get the heads and the budget info.<a name="4"></a></h2><pre class="codeinput">H = readDat([basename <span class="string">'.HDS'</span>]);  <span class="comment">% read computed heads</span>
B = readBud([basename <span class="string">'.BGT'</span>]);  <span class="comment">% read ceomputed budgets</span>
</pre><pre class="codeoutput">Reading MODFLOW binary output file &lt;&lt;generic_steady_modpath.HDS&gt;&gt; verbose= 0
Scanning headers
finished, 3 records scanned
File contains the following:
Number of records in file  :          3
Number of stress userPeriods:          1
Number of time steps       :          1
Number of layers           :          3
Number of rows             :         15
Number of columns          :         15
Maximum time in file       "          1
Reading requested data ...
     3 records read.
.     1 records in output struct.


Trying to read generic_steady_modpath.BGT as BINARY file...it works!
Scanning 7 headers
finished, 7 records scanned
File contains the following:
Number of records in file:          7
Number of stress periods :          1
Number of time steps     :          1
Number of layers         :          3
Number of Rows           :         15
Number of columns        :         15
Number of unique labels  :          7
CONSTANTHEAD
DRAINS
FLOWFRONTFACE
FLOWLOWERFACE
FLOWRIGHTFACE
RECHARGE
WELLS

Reading the requested data ...
Please wait while I'm getting the requested data ...
.......     1 records in output struct.

</pre><h2>Ways to show the data<a name="5"></a></h2><h2>Show zoneBudget<a name="6"></a></h2><p>generate a 3D zone array with zones 1, 2 and 3 corresponding to layers 1, 2, and 3. Then request the zoneBudget</p><pre class="codeinput">zoneArray = gr.const([1 2 3]);   <span class="comment">% generate the zoneArray</span>
zonebudget(B,zoneArray,1);       <span class="comment">% request zonebudget for layer 1</span>
zonebudget(B,zoneArray,2);       <span class="comment">% same for layer 2</span>
zonebudget(B,zoneArray,3);       <span class="comment">% same for layer 3</span>
zonebudget(B,zoneArray,[1 2 3]); <span class="comment">% same for all layers combined</span>
</pre><pre class="codeoutput">
============================================
zoneBudget will be computed for zones:  1

Budget [consistent model units] for period=1, itsp=1:

BUDGET FOR ZONE  1               -----IN-----  ----OUT-----
total for         CONSTANTHEAD =         0.00    6558857.91
total for        FLOWRIGHTFACE =         0.00         -0.00
total for        FLOWFRONTFACE =         0.00         -0.00
total for        FLOWLOWERFACE =     28091.22     630890.85
total for                WELLS =         0.00    1200000.00
total for               DRAINS =         0.00    2138342.46
total for             RECHARGE =  10500000.00         -0.00
                                 ------------  ------------
total for              ZONE  1 =  10528091.22   10528091.22
total net              ZONE  1 =         0.00  

============================================
zoneBudget will be computed for zones:  2

Budget [consistent model units] for period=1, itsp=1:

BUDGET FOR ZONE  2               -----IN-----  ----OUT-----
total for         CONSTANTHEAD =         0.00     302799.63
total for        FLOWRIGHTFACE =         0.00         -0.00
total for        FLOWFRONTFACE =         0.00         -0.00
total for        FLOWLOWERFACE =    827816.30     325016.67
total for                WELLS =         0.00     200000.00
total for               DRAINS =         0.00         -0.00
total for             RECHARGE =         0.00         -0.00
                                 ------------  ------------
total for              ZONE  2 =    827816.30     827816.30
total net              ZONE  2 =        -0.00  

============================================
zoneBudget will be computed for zones:  3

Budget [consistent model units] for period=1, itsp=1:

BUDGET FOR ZONE  3               -----IN-----  ----OUT-----
total for         CONSTANTHEAD =         0.00         -0.00
total for        FLOWRIGHTFACE =         0.00         -0.00
total for        FLOWFRONTFACE =         0.00         -0.00
total for        FLOWLOWERFACE =    296925.45     196925.45
total for                WELLS =         0.00     100000.00
total for               DRAINS =         0.00         -0.00
total for             RECHARGE =         0.00         -0.00
                                 ------------  ------------
total for              ZONE  3 =    296925.45     296925.45
total net              ZONE  3 =         0.00  

============================================
zoneBudget will be computed for zones:  1 2 3

Budget [consistent model units] for period=1, itsp=1:

BUDGET FOR ZONE  1 2 3           -----IN-----  ----OUT-----
total for         CONSTANTHEAD =         0.00    6861657.54
total for        FLOWRIGHTFACE =         0.00         -0.00
total for        FLOWFRONTFACE =         0.00         -0.00
total for        FLOWLOWERFACE =         0.00         -0.00
total for                WELLS =         0.00    1500000.00
total for               DRAINS =         0.00    2138342.46
total for             RECHARGE =  10500000.00         -0.00
                                 ------------  ------------
total for          ZONE  1 2 3 =  10500000.00   10500000.00
total net          ZONE  1 2 3 =         0.00  
</pre><h2>Plotting conductivities in a cross section along x-axis<a name="7"></a></h2><p>This is done using the method plotXSec of the gridObj</p><pre class="codeinput">gr.plotXSec(1,<span class="string">'figure'</span>,<span class="string">'xsec'</span>,<span class="string">'title'</span>,<span class="string">'Conductivities along y-axis'</span>,<span class="string">'fontsize'</span>,14,<span class="string">'all'</span>,<span class="string">'lay'</span>,HK,<span class="string">'cbd'</span>,VKCB);
hb = colorbar; set(get(hb,<span class="string">'title'</span>),<span class="string">'string'</span>,<span class="string">'conductivity'</span>);

<span class="comment">% Plot the heads along row iy onto this XSection</span>
iy = 8;
h(1) = plot(gr.xm,XS(H(end).values(iy,:,1)),<span class="string">'b'</span>,<span class="string">'linewidth'</span>,2); <span class="comment">% head in layer 1</span>
h(2) = plot(gr.xm,XS(H(end).values(iy,:,2)),<span class="string">'r'</span>,<span class="string">'linewidth'</span>,2); <span class="comment">% head in layer 2</span>
h(3) = plot(gr.xm,XS(H(end).values(iy,:,3)),<span class="string">'k'</span>,<span class="string">'linewidth'</span>,2); <span class="comment">% head in layer 3</span>
legend(h,<span class="string">'Layer 1'</span>,<span class="string">'Layer 2'</span>,<span class="string">'Layer 3'</span>); <span class="comment">% legend, using the handles to the 3 lines</span>
</pre><img vspace="5" hspace="5" src="mf_analyze_01.png" alt=""> <h2>Plotting conductivities in a cross section along y-axis<a name="8"></a></h2><p>This is done using method plotYsec instead of plotXsec of the gridObj</p><pre class="codeinput">gr.plotYSec(1,<span class="string">'figure'</span>,<span class="string">'ysec'</span>,<span class="string">'title'</span>,<span class="string">'Conductivities along x-axis'</span>,<span class="string">'fontsize'</span>,14,<span class="string">'all'</span>,<span class="string">'lay'</span>,HK,<span class="string">'cbd'</span>,VKCB);
hb = colorbar;  set(get(hb,<span class="string">'title'</span>),<span class="string">'string'</span>,<span class="string">'conductivity'</span>);

<span class="comment">% plot the heads onto this XSec along column ix</span>
ix = 8;
h(1) = plot(gr.ym,YS(H(end).values(:,ix,1)),<span class="string">'b'</span>,<span class="string">'linewidth'</span>,2);  <span class="comment">% layer 1</span>
h(2) = plot(gr.ym,YS(H(end).values(:,ix,2)),<span class="string">'ro'</span>,<span class="string">'linewidth'</span>,2); <span class="comment">% layer 2</span>
h(3) = plot(gr.ym,YS(H(end).values(:,ix,3)),<span class="string">'k'</span>,<span class="string">'linewidth'</span>,2);  <span class="comment">% layer 3</span>
legend(h,<span class="string">'Layer 1'</span>,<span class="string">'Layer 2'</span>,<span class="string">'Layer 3'</span>); <span class="comment">% legend using the handles to the 3 lines</span>
</pre><img vspace="5" hspace="5" src="mf_analyze_02.png" alt=""> <h2>Plotting stream function<a name="9"></a></h2><p>The figure is 3D so the stream function cannot be shown</p><h2>Plotting head contours of all layers<a name="10"></a></h2><pre class="codeinput">figure(<span class="string">'name'</span>,<span class="string">'contours of heads'</span>,<span class="string">'position'</span>,screenPos(0.6)); <span class="comment">% fig = 60% of screen</span>
ax(1) = subplot(2,2,1,<span class="string">'nextplot'</span>,<span class="string">'add'</span>);  <span class="comment">% axis to plot layer 1</span>
ax(2) = subplot(2,2,2,<span class="string">'nextplot'</span>,<span class="string">'add'</span>);  <span class="comment">% axis to plot layer 2</span>
ax(3) = subplot(2,2,3,<span class="string">'nextplot'</span>,<span class="string">'add'</span>);  <span class="comment">% axis tt plot layer 3</span>

hrange = ContourRange(H,50); <span class="comment">% get a useful set of contour elevations</span>
</pre><img vspace="5" hspace="5" src="mf_analyze_03.png" alt=""> <p>Plot the contours for the three layers</p><pre class="codeinput"><span class="keyword">for</span> ia=1:3
    xlabel(ax(ia),<span class="string">'x [m]'</span>); ylabel(ax(ia),<span class="string">'y [m]'</span>);  <span class="comment">% axis labels</span>
    title(ax(ia),sprintf(<span class="string">'Heads layer %d'</span>,ia));      <span class="comment">% title</span>
    h = colorbar(<span class="string">'peer'</span>,ax(ia)); title(h,<span class="string">'head'</span>);    <span class="comment">% colorbar for heads</span>

    contourf(ax(ia),gr.xm,gr.ym,H(end).values(:,:,ia),hrange);    <span class="comment">% contours</span>

    <span class="comment">% plot well locations of wells pertaining to each of the layers</span>
    <span class="comment">% plotting is done using method plotXY of wellObj</span>
    <span class="comment">% selection of wells is done using [well.iLay]==ia</span>
    well([well.iLay]==ia).plotXY(ax(ia),<span class="string">'marker'</span>,<span class="string">'o'</span>,<span class="string">'markerEdgeColor'</span>,<span class="string">'r'</span>);
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="mf_analyze_04.png" alt=""> <h2>Show the particles generated by MODPATH<a name="12"></a></h2><pre class="codeinput">figure;   hold <span class="string">on</span>;   view(3);
xlabel(<span class="string">'x [m]'</span>);   ylabel(<span class="string">'y [m]'</span>);   zlabel(<span class="string">'z [m]'</span>);

<span class="comment">% Plot the gridObj as a mesh (transparent)</span>
gr.plotMesh(<span class="string">'faceAlpha'</span>,0.15);
pGrp.plot();  <span class="comment">% plot the particles</span>
title(<span class="string">'Particles starting points'</span>);
</pre><img vspace="5" hspace="5" src="mf_analyze_05.png" alt=""> <h2>Look at the endpoints of the particles tracked<a name="13"></a></h2><pre class="codeinput">pGrp = pGrp.getEndPoints(<span class="string">'mp6.endp'</span>); <span class="comment">% get end points</span>
<span class="comment">%pGrp.dispEndPoints();</span>
pGrp.endPointStatistics;
<span class="comment">%pGrp.plotEndPoints(1,'ko');</span>
</pre><pre class="codeoutput"># MATLAB readEndPoints 15-Jun-2013 03:20:20

# Statistics for endpoints of group 1, 'generic_steady_modpath'
Total nr of endpoints     =   84
    pending               =    0
    active                =    0
    normally terminated   =   84
    zoneTerminated        =    0
    unreleased            =    0
    stranded              =    0
# ==============================

# Statistics for endpoints of group 2, 'generic_steady_modpath'
Total nr of endpoints     =   84
    pending               =    0
    active                =    0
    normally terminated   =   84
    zoneTerminated        =    0
    unreleased            =    0
    stranded              =    0
# ==============================

# Statistics for endpoints of group 3, 'generic_steady_modpath'
Total nr of endpoints     =   84
    pending               =    0
    active                =    0
    normally terminated   =   84
    zoneTerminated        =    0
    unreleased            =    0
    stranded              =    0
# ==============================
</pre><h2>Look at the strating points of the particles tracked<a name="14"></a></h2><pre class="codeinput">pGrp.plotStartPoints(<span class="string">'b'</span>);
</pre><h2>Plot path lines<a name="15"></a></h2><pre class="codeinput">pGrp = pGrp.getPathLines(<span class="string">'mp6.plines'</span>);
pGrp.plotPath(<span class="string">'b'</span>);

view(3);
</pre><pre class="codeoutput">
mpath_particleGroupObj: Reading path lines ...
# MATLAB readPath 15-Jun-2013 03:20:21

readPath: Reading &lt;&lt;19432&gt;&gt; records from path line file &lt;&lt;mp6.plines&gt;&gt; ...
......................
 &lt;&lt;19432&gt;&gt; lines read (thanks for waiting)

# Statistics for path file mp6.plines
Total nr of points     = 102
Total nr of time steps = 1
Min time               = 0
Max time               = 1.30825e+06
# ==============================

Sorting pathline points ... done

Plotting pathlines
Group  3,  sorting, plotting, done.
Group  2,  sorting, plotting, done.
Group  1,  sorting, plotting, done.
</pre><img vspace="5" hspace="5" src="mf_analyze_06.png" alt=""> <h2>TO 130614<a name="16"></a></h2><p class="footer"><br>
      Published with MATLAB&reg; 7.13<br></p></div><!--
##### SOURCE BEGIN #####
%% Visualization of steady model results with particle tracking

%% Closing existing graphs and variables
close all;
clear variables;

%% The options and steps will be outlined here
% Notice that there are many more visualization options. One of them are
% animations and video's that are generally used in combation with
% transient flow and with mass transport simulations. Here we only have a
% steady-steate model.

%% First step: retrieve the basename of this model
load name       % retrieve basename stored in file name.mat
load(basename)  % get model arrays that were saved by mf_setup

%% Get the heads and the budget info.
H = readDat([basename '.HDS']);  % read computed heads
B = readBud([basename '.BGT']);  % read ceomputed budgets

%% Ways to show the data

%% Show zoneBudget
%
% generate a 3D zone array with zones 1, 2 and 3 corresponding
% to layers 1, 2, and 3. Then request the zoneBudget
zoneArray = gr.const([1 2 3]);   % generate the zoneArray
zonebudget(B,zoneArray,1);       % request zonebudget for layer 1
zonebudget(B,zoneArray,2);       % same for layer 2
zonebudget(B,zoneArray,3);       % same for layer 3
zonebudget(B,zoneArray,[1 2 3]); % same for all layers combined

%% Plotting conductivities in a cross section along x-axis
% This is done using the method plotXSec of the gridObj

gr.plotXSec(1,'figure','xsec','title','Conductivities along y-axis','fontsize',14,'all','lay',HK,'cbd',VKCB);
hb = colorbar; set(get(hb,'title'),'string','conductivity');

% Plot the heads along row iy onto this XSection
iy = 8;
h(1) = plot(gr.xm,XS(H(end).values(iy,:,1)),'b','linewidth',2); % head in layer 1
h(2) = plot(gr.xm,XS(H(end).values(iy,:,2)),'r','linewidth',2); % head in layer 2
h(3) = plot(gr.xm,XS(H(end).values(iy,:,3)),'k','linewidth',2); % head in layer 3
legend(h,'Layer 1','Layer 2','Layer 3'); % legend, using the handles to the 3 lines

%% Plotting conductivities in a cross section along y-axis
% This is done using method plotYsec instead of plotXsec of the gridObj
gr.plotYSec(1,'figure','ysec','title','Conductivities along x-axis','fontsize',14,'all','lay',HK,'cbd',VKCB);
hb = colorbar;  set(get(hb,'title'),'string','conductivity');

% plot the heads onto this XSec along column ix
ix = 8;
h(1) = plot(gr.ym,YS(H(end).values(:,ix,1)),'b','linewidth',2);  % layer 1
h(2) = plot(gr.ym,YS(H(end).values(:,ix,2)),'ro','linewidth',2); % layer 2
h(3) = plot(gr.ym,YS(H(end).values(:,ix,3)),'k','linewidth',2);  % layer 3
legend(h,'Layer 1','Layer 2','Layer 3'); % legend using the handles to the 3 lines

%% Plotting stream function
% The figure is 3D so the stream function cannot be shown

%% Plotting head contours of all layers

figure('name','contours of heads','position',screenPos(0.6)); % fig = 60% of screen
ax(1) = subplot(2,2,1,'nextplot','add');  % axis to plot layer 1
ax(2) = subplot(2,2,2,'nextplot','add');  % axis to plot layer 2 
ax(3) = subplot(2,2,3,'nextplot','add');  % axis tt plot layer 3

hrange = ContourRange(H,50); % get a useful set of contour elevations

%%
% Plot the contours for the three layers
for ia=1:3
    xlabel(ax(ia),'x [m]'); ylabel(ax(ia),'y [m]');  % axis labels
    title(ax(ia),sprintf('Heads layer %d',ia));      % title
    h = colorbar('peer',ax(ia)); title(h,'head');    % colorbar for heads

    contourf(ax(ia),gr.xm,gr.ym,H(end).values(:,:,ia),hrange);    % contours
    
    % plot well locations of wells pertaining to each of the layers
    % plotting is done using method plotXY of wellObj
    % selection of wells is done using [well.iLay]==ia
    well([well.iLay]==ia).plotXY(ax(ia),'marker','o','markerEdgeColor','r');
end


%% Show the particles generated by MODPATH

figure;   hold on;   view(3);
xlabel('x [m]');   ylabel('y [m]');   zlabel('z [m]');

% Plot the gridObj as a mesh (transparent)
gr.plotMesh('faceAlpha',0.15);
pGrp.plot();  % plot the particles
title('Particles starting points');

%% Look at the endpoints of the particles tracked
pGrp = pGrp.getEndPoints('mp6.endp'); % get end points
%pGrp.dispEndPoints();
pGrp.endPointStatistics;
%pGrp.plotEndPoints(1,'ko');

%% Look at the strating points of the particles tracked
pGrp.plotStartPoints('b');

%% Plot path lines
pGrp = pGrp.getPathLines('mp6.plines');
pGrp.plotPath('b');

view(3);


%% TO 130614
##### SOURCE END #####
--></body></html>