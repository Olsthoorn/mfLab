
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Script NHI (netherlands hydrologic instrument)</title><meta name="generator" content="MATLAB 7.13"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2012-08-09"><meta name="DC.source" content="NHI.m"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h1>Script NHI (netherlands hydrologic instrument)</h1><!--introduction--><p>This script extracTs the data from the NHI ASCII files that are locally stored in directory mfLab/examples/NHI/NHIascii. These files on their turn were obtained thoungh unzipping the files in mfLab/examples/NHI/NHIzipfiles. The zipfiles were downloaded from the official NHI site (www.NHI.nu/bibliotheek).</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">The NHI files</a></li><li><a href="#3">Variable types for layer processing</a></li><li><a href="#4">Setting up the directories and basename</a></li><li><a href="#7">Change to NHIdir directory</a></li><li><a href="#8">Determine the number of NHI layers automatically</a></li><li><a href="#9">Determing the number of confining beds</a></li><li><a href="#10">Set minimum layer thickness</a></li><li><a href="#11">Get meta data for cell-arrays</a></li><li><a href="#12">Compute grid-line coordinates for NHI based on meta data just obtained</a></li><li><a href="#14">Get the actual data and save them into mat files in the data directory</a></li><li><a href="#15">Get transmissivities</a></li><li><a href="#16">Vertical hydraulic resistance of confining beds</a></li><li><a href="#17">Starting heads</a></li><li><a href="#18">Cell-based recharge</a></li><li><a href="#19">Elevation of all layers and model grid object</a></li><li><a href="#27">Generate the mfLab grid object:</a></li><li><a href="#29">Stresses</a></li><li><a href="#30">Get the stresses for the RIV package (surface water)</a></li><li><a href="#32">Get the stresses for the general head package (GHB)</a></li><li><a href="#33">Get the stresses for the drain package (DRN)</a></li><li><a href="#34">Get the wells (WEL)</a></li><li><a href="#36">Get wells.</a></li><li><a href="#37">Done</a></li><li><a href="#38">Save the struct whit the names of the saved variables</a></li><li><a href="#39">TODO:</a></li><li><a href="#40">Show STRTHD in 3D</a></li></ul></div><h2>The NHI files<a name="1"></a></h2><p>These NHI files consitute the cell-based data of the national hydrologic instrument, a currently 7 aquifer and 6 aquitard nation-wide finite difference groundwater (and surface water) model. The exent of the model is 1200 by 1300 cells with constant cell resolution 250 by to 250 m.</p><p>This script,</p><pre class="codeinput">mfilename
</pre><pre class="codeoutput">
ans =

NHI

</pre><p>reads the ASCII files and saves them as MATLAB mat files to gain maximum speed in later usage while using least diskspace. The total size of the ASCII files so reduces to around 250 Mb. To my knowledge this is the most efficient way of storage we can get.</p><p>The stored files are generally either 3D arrays of some parameter or cell-based lists specifying stresses for the MODFLOW model. The stresses are for the WEL, GHB, RIV and the DRN package.</p><p>The data for the 3D arrays are provided in separate file, one for each layer and contained in one or more zip files.</p><p>Some special care had to be taken with respect to the elevations of the tops and bottoms of the layers. The top is contained in the AHN file, the "Algemene Hoogtekaart Nederland" (General Elevation MAP (or DEM) of the Netherlands). The elevations in it are given in m units above national datum (NAP), while all other layer-top and bottom elevations are given in cm.</p><p>Anisotropy, necessary to model the ice-pushed formations in the center of the Netherlands is defined through an anisotropy factor and the angle of the direction of the main anisotropy axis with respect to the North (clockwise positive). Anioatropy may be neglected when modeling parts without it.</p><p>The files do not contain basic data, but just the derived data values per model cell. There is one exception: The WEL list also contains the actual x,y coordinates of wells and their extraction. The extraction is some long-term average value (details to be looked up).</p><p>The Excel workbook mflab/examples/NHI/NHI.xls lists all zip files and the ASCII files as well as their translation to the mat files generated from them. When the NHI model is renewed, the zip files have to be reloaded and this workbook may have to be updated as well. Currently, the entire model consists of about 120 ascii files.</p><p>The NHI site and the NHI documentation on that site lack a descripition of all the individual files. This makes it hard to figure out what exactly is their contents, and even more so, how the files have been generated and how to interpret them correctly. It is the ambition to find out, so that their description can be added to the workbook HNI.xls for reference.</p><p>Finally, note that the data provided by www.NHI.nu are only steady-state data. There are no dynamic stress period data available at this time. Exact 3D data on the subsurface salinity distribution are also lacking. I will do my best to use the 3D salinity data of the Deltares institute model for South-Holland, which covers about half the country. When the 3D data become available, it will be downloaded and will replace the South-Holland data.</p><p>The current data set was downloaded around early April 2012.</p><p>TO 120808</p><h2>Variable types for layer processing<a name="3"></a></h2><p>Each varialble will be given a type that will be stored along with the variable in the matfile, to facilitate handling the variable when reloaded later on. The possible type so far are</p><pre class="codeinput">varTypes = {
    <span class="string">'3Dlay'</span>;           <span class="comment">% a 3D array size of model (Ny,Nx,NLay)</span>
    <span class="string">'3Dcbd'</span>;           <span class="comment">% 2 3D array size of confining beds (Ny,Nz,Ncbd)</span>
    <span class="string">'3Dtime'</span>;          <span class="comment">% a 2D-time array, e.g. recharge (Ny,Nx,Nt)</span>
    <span class="string">'gridObj'</span>;         <span class="comment">% a matlab grid object</span>
    <span class="string">'wellObj'</span>;         <span class="comment">% an array of mflab well objects</span>
    <span class="string">'wellSeriesObj'</span>;   <span class="comment">% an array of mflab well series objects</span>
    <span class="string">'struct'</span>;          <span class="comment">% a struct like ZETA</span>
    <span class="string">'stress'</span>;          <span class="comment">% a stres (GHB, RIV, ..) i.e. [it iz iy ix values]</span>
    <span class="string">'zlist'</span>            <span class="comment">% one value per layer list such as wettability</span>
    };
</pre><h2>Setting up the directories and basename<a name="4"></a></h2><p>Basename used for this directory and the workbook with the file names</p><pre class="codeinput">basename  = <span class="string">'NHI'</span>;
</pre><p>Path to NHI dir, adapt for your personal computer</p><pre class="codeinput">NHIdir  = <span class="string">'/Users/Theo/GRWMODELS/mflab/examples/NHI/'</span>;

asciiFilesDir  = <span class="string">'NHIascii'</span>;    <span class="comment">% name of subdirectory with NHI ascii files</span>
datadir        = <span class="string">'NHIdata'</span>;     <span class="comment">% name of subdirectory with the NHI mat files</span>
sheetNm        = <span class="string">'files'</span>;       <span class="comment">% name of worksheet in &lt;&lt;basename&gt;&gt;.xls with names of zipped and ascii files</span>
columnHdr      = <span class="string">'variable'</span>;    <span class="comment">% name of column in &lt;&lt;sheetNm&gt;&gt; with MODFLOW variable name connected to ascii file</span>
</pre><p>Inform user</p><pre class="codeinput">fmt = <span class="string">'%56s = %s\n'</span>;
fprintf(fmt,<span class="string">'basename'</span>,basename);
fprintf(fmt,<span class="string">'subdirectory with NHI ascii files'</span>,NHIdir);
fprintf(fmt,<span class="string">'subdirectory with NHI mat files'</span>,datadir);
fprintf(fmt,<span class="string">'workshee with NHI ascii file names'</span>,sheetNm);
fprintf(fmt,<span class="string">'column naming the model variable or resulting mat file'</span>,columnHdr);
</pre><pre class="codeoutput">                                                basename = NHI
                       subdirectory with NHI ascii files = /Users/Theo/GRWMODELS/mflab/examples/NHI/
                         subdirectory with NHI mat files = NHIdata
                      workshee with NHI ascii file names = files
  column naming the model variable or resulting mat file = variable
</pre><h2>Change to NHIdir directory<a name="7"></a></h2><pre class="codeinput">eval([<span class="string">'cd '</span> NHIdir]);
</pre><h2>Determine the number of NHI layers automatically<a name="8"></a></h2><p>The number of NHI layers equals the number of aquifers, taken from the files starting with kD</p><pre class="codeinput">Nlay = length(dir(fullfile(asciiFilesDir,<span class="string">'KD*.ASC'</span>)));
fprintf(fmt,<span class="string">'The number of model layers'</span>,sprintf(<span class="string">'%d'</span>,Nlay));
</pre><pre class="codeoutput">                              The number of model layers = 7
</pre><h2>Determing the number of confining beds<a name="9"></a></h2><p>All NHI layers (except the last) have a confining bed below them, so we skip this by setting LAYCBD immediately as follows</p><pre class="codeinput">LAYCBD = ones(1,Nlay);
</pre><h2>Set minimum layer thickness<a name="10"></a></h2><p>Many layers have zero thickness over at least parts of their exent, whlile subtraction of the first bottom from the DEM even yields negative thickness over part of the area. Therefore, we guarantee a minimum thickness as specified by MINDZ here</p><pre class="codeinput">MINDZ = 0.1;

fprintf(fmt,<span class="string">'LAYCBD'</span>,<span class="string">'all but the last layers have a confining bed below them'</span>);
fprintf(fmt,<span class="string">'MINDZ: Minimum layer thickness used in NHI.\n'</span>,MINDZ);
</pre><pre class="codeoutput">                                                  LAYCBD = all but the last layers have a confining bed below them
           MINDZ: Minimum layer thickness used in NHI.\n = 1.000000e-01
</pre><h2>Get meta data for cell-arrays<a name="11"></a></h2><p>Every ASCII file specifying some layer variable such as KD1.ASC contains meta data concerning the extent of the grid end its lower left coordinate in the national Dutch system ("Rijksdriehoeksmeting"). Note that conversion between the national x,y and the international WGS84 system used by Google can be done within mfLab using the WGS2RD and RD2WGS functions. Here we read out the meta data, using the ASCII file KD1.ASC for the purpose.</p><pre class="codeinput">fid = fopen(fullfile(asciiFilesDir,<span class="string">'KD1.ASC'</span>),<span class="string">'r'</span>);
    meta = getNHImeta(fid);
fclose(fid);
</pre><h2>Compute grid-line coordinates for NHI based on meta data just obtained<a name="12"></a></h2><p>The cell center coordinates follow from the grid line coordinates and the cell size. We don't need them, because we will use mfLab's  grid object later on for all coordinate work.</p><pre class="codeinput">fprintf(<span class="string">'Computing the NHI grid line coordinates from NHI meta data.\n'</span>);

xGrNHI = meta.XLLCORNER+(0:+1:meta.NCOLS)*meta.CELLSIZE;
yGrNHI = meta.YLLCORNER+(meta.NROWS:-1:0)*meta.CELLSIZE;
</pre><pre class="codeoutput">Computing the NHI grid line coordinates from NHI meta data.
</pre><p>Compute the indices of the model. Subsets may be used in functions applied further down to select data for a submodel.</p><pre class="codeinput">Ix= 1:meta.NCOLS;  fprintf(<span class="string">'Number of columns in NHI = %d\n'</span>,meta.NCOLS);
Iy= 1:meta.NROWS;  fprintf(<span class="string">'Number of rows    in NHI = %d\n'</span>,meta.NROWS);
</pre><pre class="codeoutput">Number of columns in NHI = 1200
Number of rows    in NHI = 1300
</pre><h2>Get the actual data and save them into mat files in the data directory<a name="14"></a></h2><p>To generate the mat files for cell layer variables such as transmmissivity and elevations, we have to read out the ascii file of each layer and join them in a 3D MATLAB array. In the process we may rename the variable to a more international standard, like TRAN instead of kD, and we may convert the variable as required by MODFLOW, such as VCONT instead of C. Instead of separate 3D files of the tops and the bottoms of all layers, we use Z, which is a sequence of layer interface planes, starting at ground surface and ending at the bottom of the model, which combines both the aquifer-layers and the aquitard confining beds.</p><h2>Get transmissivities<a name="15"></a></h2><pre class="codeinput">[TRAN,NHIvars.TRAN]  = makeArray(basename,sheetNm,asciiFilesDir,columnHdr,<span class="string">'TRAN'</span>,Ix,Iy);
TRANtype = <span class="string">'3Dlay'</span>;
save(fullfile(NHIdir,datadir,<span class="string">'TRAN'</span>),<span class="string">'TRAN'</span>,<span class="string">'TRANtype'</span>);
</pre><pre class="codeoutput">Reading file    'NHIascii/KD1.ASC'
Reading file    'NHIascii/KD2.ASC'
Reading file    'NHIascii/KD3.ASC'
Reading file    'NHIascii/KD4.ASC'
Reading file    'NHIascii/KD5.ASC'
Reading file    'NHIascii/KD6.ASC'
Reading file    'NHIascii/KD7.ASC'
</pre><h2>Vertical hydraulic resistance of confining beds<a name="16"></a></h2><p>In the Netherlands we always characterize the hydraulic vertical conductance combined with the thickness by their total hydraulic resistance, which equals c=DZ/kv (time]. In the USA and MOFLOW VCONT is used in stead, which is kv/DZ [1/time]. Therefore there is no fundamental difference between using one or the other. As the www.NHI.nu site publishes the c-values we will use them as well and take the reciprocal whenever we need them in MODFLOW later on.</p><pre class="codeinput">[C NHIvars.C] = makeArray(basename,sheetNm,asciiFilesDir,columnHdr,<span class="string">'C'</span>,Ix,Iy');
Ctype = <span class="string">'3Dlay'</span>;
save(fullfile(NHIdir,datadir,<span class="string">'C'</span>),<span class="string">'C'</span>,<span class="string">'Ctype'</span>);
</pre><pre class="codeoutput">Reading file    'NHIascii/C1.ASC'
Reading file    'NHIascii/C2.ASC'
Reading file    'NHIascii/C3.ASC'
Reading file    'NHIascii/C4.ASC'
Reading file    'NHIascii/C5.ASC'
Reading file    'NHIascii/C6.ASC'
</pre><h2>Starting heads<a name="17"></a></h2><p>Although not strictly necessary for steady-state models, unless used for fixed heads, we will still use the starting heads to initalize the the solver. This starts the convergence as closely as possible to the final results.</p><pre class="codeinput">[STRTHD NHIvars.STRTHD]  = makeArray(basename,sheetNm,asciiFilesDir,columnHdr,<span class="string">'STRTHD'</span>,Ix,Iy);
STRTHDtype = <span class="string">'3Dlay'</span>;
save(fullfile(NHIdir,datadir,<span class="string">'STRTHD'</span>),<span class="string">'STRTHD'</span>,<span class="string">'STRTHDtype'</span>);
</pre><pre class="codeoutput">Reading file    'NHIascii/SHEAD_NHI22_L1.ASC'
Reading file    'NHIascii/SHEAD_NHI22_L2.ASC'
Reading file    'NHIascii/SHEAD_NHI22_L3.ASC'
Reading file    'NHIascii/SHEAD_NHI22_L4.ASC'
Reading file    'NHIascii/SHEAD_NHI22_L5.ASC'
Reading file    'NHIascii/SHEAD_NHI22_L6.ASC'
Reading file    'NHIascii/SHEAD_NHI22_L7.ASC'
</pre><h2>Cell-based recharge<a name="18"></a></h2><p>The NHI site gives one ASCII cell-based file for the net recharge. It must be some properly chosen long-term average value, which does not become clear from the site. The exact origin is still to be requested from the developers. The recharge is a 2D matrix. There is no need to generate a 3D array from it.</p><pre class="codeinput">[fname NHIvars.RECH] = getNHIfileNm(basename,sheetNm,columnHdr,<span class="string">'RECH'</span>);
RECH     = getNHIASC(fullfile(asciiFilesDir,fname),Ix,Iy);
RECHtype = <span class="string">'3Dtime'</span>;

save(fullfile(NHIdir,datadir,<span class="string">'RECH'</span>),<span class="string">'RECH'</span>,<span class="string">'RECHtype'</span>);
</pre><pre class="codeoutput">Reading file    'NHIascii/RCH.ASC'
</pre><h2>Elevation of all layers and model grid object<a name="19"></a></h2><p>Get layer top and bottom elevations of layers and aquitards</p><pre class="codeinput">[Z NHIvars.Z] = makeArray(basename,sheetNm,asciiFilesDir,columnHdr,<span class="string">'Z'</span>,Ix,Iy);
</pre><pre class="codeoutput">Reading file    'NHIascii/AHN_F250.ASC'
Reading file    'NHIascii/top_sdl1.asc'
Reading file    'NHIascii/bot_sdl1.ASC'
Reading file    'NHIascii/top_sdl2.asc'
Reading file    'NHIascii/bot_sdl2.ASC'
Reading file    'NHIascii/top_sdl3.asc'
Reading file    'NHIascii/bot_sdl3.ASC'
Reading file    'NHIascii/top_sdl4.asc'
Reading file    'NHIascii/bot_sdl4.ASC'
Reading file    'NHIascii/top_sdl5.asc'
Reading file    'NHIascii/bot_sdl5.ASC'
Reading file    'NHIascii/top_sdl6.asc'
Reading file    'NHIascii/bot_sdl6.ASC'
Reading file    'NHIascii/geohydrologische_basis.asc'
</pre><p>Convert all Z(:,:,2:end) from cm to m, except Z1 = groundsurface which is already in m above datum</p><pre class="codeinput">Z(:,:,2:end)=Z(:,:,2:end)/100;
</pre><p>Remove the NaNs of internal surface waters in AHN The AHN DEM contains nodata where surface water is present. For any model use we need proper elevation data here as well. We obtain these data by replacing the NaNs in the ASCII file by corresponding values of Z(:,:,2), the second layer, i.e. the bottom of the first model layer. Note that zero thickness that are the consequence of this procedure will be eleminated next.</p><pre class="codeinput">z2=Z(:,:,2); <span class="comment">% second plane</span>
</pre><p>list of indices in the first layer correspond to second loose layer</p><pre class="codeinput">Z(isnan(Z(:,:,1)))=z2(isnan(Z(:,:,1)));
</pre><p>Make sure that bottoms are at or below tops of layers working downward.</p><pre class="codeinput"><span class="keyword">for</span> i=2:size(Z,3)
    dz = max(diff(Z(:,:,[i i-1]),1,3),MINDZ);
    Z(:,:,i)=Z(:,:,i-1)-dz;
<span class="keyword">end</span>
</pre><p>Verify that each laye ris below its top. To do this, get DZ and and compute the minimum thickness of each layer.</p><pre class="codeinput">DZ= abs(diff(Z,1,3));
<span class="keyword">for</span> iz=1:size(DZ,3);
    fprintf(<span class="string">'Thickness DZ of layer %2d varies between %12.3f and%12.3f\n'</span>,<span class="keyword">...</span>
        iz,min(min(DZ(:,:,iz))),max(max(DZ(:,:,iz))));
<span class="keyword">end</span>
</pre><pre class="codeoutput">Thickness DZ of layer  1 varies between        0.100 and      60.190
Thickness DZ of layer  2 varies between        0.100 and       0.100
Thickness DZ of layer  3 varies between        0.100 and     125.310
Thickness DZ of layer  4 varies between        0.100 and      85.124
Thickness DZ of layer  5 varies between        0.100 and      83.502
Thickness DZ of layer  6 varies between        0.100 and     111.385
Thickness DZ of layer  7 varies between        0.100 and     242.389
Thickness DZ of layer  8 varies between        0.100 and     126.864
Thickness DZ of layer  9 varies between        0.100 and     157.590
Thickness DZ of layer 10 varies between        0.100 and     201.265
Thickness DZ of layer 11 varies between        0.100 and     255.120
Thickness DZ of layer 12 varies between        0.100 and     152.623
Thickness DZ of layer 13 varies between        0.100 and     511.431
</pre><p>save Z</p><pre class="codeinput">Ztype = <span class="string">'3Dlay'</span>;
save(fullfile(NHIdir,datadir,<span class="string">'Z'</span>),<span class="string">'Z'</span>,<span class="string">'Ztype'</span>);
</pre><h2>Generate the mfLab grid object:<a name="27"></a></h2><p>The mfLab grid object contains all grid data and the methods to deal with them. It is a key object in mfLab. So create it:</p><pre class="codeinput">gr= gridObj(xGrNHI,yGrNHI,Z,LAYCBD,MINDZ);
NHIvars.gr ={ <span class="string">'gr'</span> <span class="string">'noFile'</span> <span class="string">'nozip'</span> <span class="string">'generated NHI grid'</span> };
</pre><pre class="codeoutput">Warning: gridObj/gridObj: min layer thickness = 0.1 (&lt;1.000000e-01),
correct this before restarting. 
</pre><p>Save the grid</p><pre class="codeinput">GRIDtype = <span class="string">'gridObj'</span>;
save(fullfile(NHIdir,datadir,<span class="string">'gr'</span>),<span class="string">'gr'</span>,<span class="string">'GRIDtype'</span>);
</pre><h2>Stresses<a name="29"></a></h2><p>Next, the stresses are read and stored. The stresses comprise the wells, and the data lists for the general head-boundary package (GHB), the drain package (DRN) the river package (RIV) and possibly other packages such as the drains with return flow (DRT), the changing head package (CHD) and the steam-routing package (STR). However, until now NHI only uses WEL, DRN, GHB and RIV packages. The stress packages are lists with one line per model cell. A list possibly contains hundreds of thousands of lines, each of which specifies the indices of the position of the cell in the grid and its data. Processing may, therefore, take same more time, although it is not generally overwhelming.</p><p>When reading the stresses we have to consider the indices of the current grid, which are, in the case we select a submodel, a subset of all indices, requiring renumbering of the indices on every line of each of the stress lists. This renumbmering is done here to remain general. If the total model is selected, then renumbering has no effect.</p><h2>Get the stresses for the RIV package (surface water)<a name="30"></a></h2><p>The NHI site gives several files for this package.Each refers to a different level of the represented surface water in the cells in a hierarchical surface-water ranking system. There are also files for different seasons, i.e. winter and summer and year-average files. We will only use the year-average files here at this time.</p><pre class="codeinput">fprintf(<span class="string">'Getting RIV for interaction with main, primary, secondary and tertiary surface water.\n'</span>);
[RIV0 NHIvars.RIV0] = getNHIBCN({<span class="string">'RIVHMY'</span>  <span class="string">'RIVCM'</span>  <span class="string">'RIVBMY'</span> },basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
[RIV1 NHIvars.RIV1] = getNHIBCN({<span class="string">'RIVHP1Y'</span> <span class="string">'RIVCP1'</span> <span class="string">'RIVBP1Y'</span>},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
[RIV2 NHIvars.RIV2] = getNHIBCN({<span class="string">'RIVHS1Y'</span> <span class="string">'RIVCS1'</span> <span class="string">'RIVBS1Y'</span>},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
[RIV3 NHIvars.RIV3] = getNHIBCN({<span class="string">'RIVHT1Y'</span> <span class="string">'RIVCT1'</span> <span class="string">'RIVBT1Y'</span>},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
</pre><pre class="codeoutput">Getting RIV for interaction with main, primary, secondary and tertiary surface water.
Reading file    'NHIascii/peil_hj_250.ASC'
Reading file    'NHIascii/cond_h_250.ASC'
Reading file    'NHIascii/bodh_hj_250.ASC'
Reading file    'NHIascii/peil_p1j_250.ASC'
Reading file    'NHIascii/cond_p1_250.ASC'
Reading file    'NHIascii/bodh_p1j_250.ASC'
Reading file    'NHIascii/peil_s1j_250.ASC'
Reading file    'NHIascii/cond_s1_250.ASC'
Reading file    'NHIascii/bodh_s1j_250.ASC'
Reading file    'NHIascii/peil_t1j_250.ASC'
Reading file    'NHIascii/cond_t1_250.ASC'
Reading file    'NHIascii/bodh_t1j_250.ASC'
</pre><p>Put RIV into the layer that agrees with the corresponding depth of the cell bottom:</p><pre class="codeinput">RIV0=setRIVdepth(RIV0,Z,gr.LAYCBD);
RIV1=setRIVdepth(RIV1,Z,gr.LAYCBD);
RIV2=setRIVdepth(RIV2,Z,gr.LAYCBD);
RIV3=setRIVdepth(RIV3,Z,gr.LAYCBD);

RIV0type = <span class="string">'stress'</span>;
RIV1type = <span class="string">'stress'</span>;
RIV2type = <span class="string">'stress'</span>;
RIV3type = <span class="string">'stress'</span>;
save(fullfile(NHIdir,datadir,<span class="string">'RIV0'</span>),<span class="string">'RIV0'</span>,<span class="string">'RIV0type'</span>);
save(fullfile(NHIdir,datadir,<span class="string">'RIV1'</span>),<span class="string">'RIV1'</span>,<span class="string">'RIV1type'</span>);
save(fullfile(NHIdir,datadir,<span class="string">'RIV2'</span>),<span class="string">'RIV2'</span>,<span class="string">'RIV2type'</span>);
save(fullfile(NHIdir,datadir,<span class="string">'RIV3'</span>),<span class="string">'RIV3'</span>,<span class="string">'RIV3type'</span>);
</pre><h2>Get the stresses for the general head package (GHB)<a name="32"></a></h2><p>The structure of the files is as described before for the RIV package. The files hereafter are used to set the infiltration resistance. This is to differenciate infiltration resistance from drainage resistance. Therefore, RIV is used to extract the corresponding heads.</p><pre class="codeinput">fprintf(<span class="string">'Getting GHB to be used for infiltration resistances:\n'</span>);
[GHB0 NHIvars.GHB0] = getNHIBCN({<span class="string">'RIVHMY'</span>  <span class="string">'GHBCM'</span> },basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
[GHB1 NHIvars.GHB1] = getNHIBCN({<span class="string">'RIVHP1Y'</span> <span class="string">'GHBCP1'</span>},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
[GHB2 NHIvars.GHB2] = getNHIBCN({<span class="string">'RIVHS1Y'</span> <span class="string">'GHBCS1'</span>},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);

GHB0type = <span class="string">'stress'</span>;
GHB1type = <span class="string">'stress'</span>;
GHB2type = <span class="string">'stress'</span>;
save(fullfile(NHIdir,datadir,<span class="string">'GHB0'</span>),<span class="string">'GHB0'</span>,<span class="string">'GHB0type'</span>);
save(fullfile(NHIdir,datadir,<span class="string">'GHB1'</span>),<span class="string">'GHB1'</span>,<span class="string">'GHB1type'</span>);
save(fullfile(NHIdir,datadir,<span class="string">'GHB2'</span>),<span class="string">'GHB2'</span>,<span class="string">'GHB2type'</span>);
</pre><pre class="codeoutput">Getting GHB to be used for infiltration resistances:
Reading file    'NHIascii/peil_hj_250.ASC'
Reading file    'NHIascii/infmf_h_250.ASC'
Reading file    'NHIascii/peil_p1j_250.ASC'
Reading file    'NHIascii/infmf_p1_250.ASC'
Reading file    'NHIascii/peil_s1j_250.ASC'
Reading file    'NHIascii/infmf_s1_250.ASC'
</pre><h2>Get the stresses for the drain package (DRN)<a name="33"></a></h2><p>The NHI model uses the drain package to specify tile drainage only.</p><pre class="codeinput">[DRN NHIvars.DRN]  = getNHIBCN({<span class="string">'DRNH'</span> <span class="string">'DRNC'</span>},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
DRNtype = <span class="string">'stress'</span>;
save(fullfile(NHIdir,datadir,<span class="string">'DRN'</span>),<span class="string">'DRN'</span>,<span class="string">'DRNtype'</span>);
</pre><pre class="codeoutput">Reading file    'NHIascii/bodh_b_250.ASC'
Reading file    'NHIascii/cond_b_250.ASC'
</pre><h2>Get the wells (WEL)<a name="34"></a></h2><p>The NHI well file is special in that it contains two types of wells. The lines beyond about 3000 have as a comment the word 'SUR'. I, therefore, named these wells 'SURwells'. Plotting the surwells on a map reveals that they fully cover certain areas in the south-eastern part of the Netherlands. So presmumably these wells are irrigation wells, used to irrigate land from local groudwater. They are also shallow. The first about 3000 lines concern regulary wells, generally those of the drinking-water companies and industries. These wells are most often deeper, with screens in semi-confined aquifers. Each line of these wells contains further details, namely the actual well-specific data, among which are its x,y location and its actual extraction. More than one well may reside in a single cell, as MODFLOW will simply add them. This way the true well data are contained in the NHI well file.</p><p>When reading the well file, a separate array of mflab well objects is generated with the actual well data. This array can be used with any model and submodel without the wel file list, as the latter is specific to the grid of the NHI groundwater model. Each of the lines in the regular wells also has a decrete value of the local transmmissivity. This too may be very useful for further modeling. A special transmissivy object array is also generated during the while reading and processing the well file.</p><p>First get well-file name</p><pre class="codeinput">[fname names] = getNHIfileNm(basename,sheetNm,columnHdr,<span class="string">'WELL'</span>);
</pre><h2>Get wells.<a name="36"></a></h2><p>Note that surwells(=irrigation wells?) are special, kD is at well sites. * well is the array of well objects * surwell is the array of surwell objects * kD is the array of transmissivit objects * WEL is the well list such as is processed by the MODFLOW's well package.</p><pre class="codeinput">[well,surwell,kD,WEL] = getNHISCD(gr,fullfile(asciiFilesDir,fname),Ix,Iy);

NHIvars.WEL     = names;
NHIvars.well    = NHIvars.WEL;
NHIvars.surwell = NHIvars.WEL;
NHIvars.kD      = NHIvars.WEL;

welltype    = <span class="string">'wellObj'</span>;
surwelltype = <span class="string">'wellObj'</span>;
kDtype      = <span class="string">'kDObj'</span>;
WELtype     = <span class="string">'stress'</span>;
save(fullfile(NHIdir,datadir,<span class="string">'well'</span>),<span class="string">'well'</span>,<span class="string">'welltype'</span>);
save(fullfile(NHIdir,datadir,<span class="string">'surwell'</span>),<span class="string">'surwell'</span>,<span class="string">'surwelltype'</span>);
save(fullfile(NHIdir,datadir,<span class="string">'kDobj'</span>),<span class="string">'kD'</span>,<span class="string">'kDtype'</span>);
save(fullfile(NHIdir,datadir,<span class="string">'WEL'</span>),<span class="string">'WEL'</span>,<span class="string">'WELtype'</span>);
</pre><pre class="codeoutput">Reading file    'NHIascii/onttrekkingen.scd'
The file holding all wells of the NHI.
Checking normal wells...
Filling 62483 wells with data read from file:
..
2938 wells inspected and 2938 wells in wellbundle{1} in subgrid
Checking sur wells ...
.........................
59545 wells inspected, .........................
59545 wells inspected, .........
59545 wells inspected and 59545 wells found in wellbundle{2} in subgrid

62483 wells inspected, 62483 wells found in subgrid

</pre><h2>Done<a name="37"></a></h2><pre class="codeinput">fprintf(<span class="string">'\n'</span>);
fprintf(<span class="string">'All NHI data are saved as matfiles in the directory   &lt;&lt;%s&gt;&gt;\n'</span>,fullfile(NHIdir,datadir,<span class="string">''</span>));
fprintf(<span class="string">'File and variable names are in Excel workbook         &lt;&lt;%s&gt;&gt;\n'</span>,fullfile(NHIdir,[basename <span class="string">'.xls'</span>]));
</pre><pre class="codeoutput">
All NHI data are saved as matfiles in the directory   &lt;&lt;/Users/Theo/GRWMODELS/mflab/examples/NHI/NHIdata&gt;&gt;
File and variable names are in Excel workbook         &lt;&lt;/Users/Theo/GRWMODELS/mflab/examples/NHI/NHI.xls&gt;&gt;
</pre><h2>Save the struct whit the names of the saved variables<a name="38"></a></h2><pre class="codeinput">NHIvarstype = <span class="string">'vars'</span>;
save(fullfile(NHIdata,<span class="string">'NHIvars'</span>),<span class="string">'NHIvars'</span>,<span class="string">'NHIvarstype'</span>);
</pre><pre class="codeoutput">Undefined function or variable 'NHIdata'.

Error in NHI (line 401)
save(fullfile(NHIdata,'NHIvars'),'NHIvars','NHIvarstype');
</pre><h2>TODO:<a name="39"></a></h2><div><ul><li>Verification</li><li>Viewing</li></ul></div><h2>Show STRTHD in 3D<a name="40"></a></h2><p>For any part of the model coutour this part using indces and put this in a new grid (see how this in done in extactFromNHI.m in the example directories may be too big to show on smaller PCs</p><pre class="codeinput"><span class="comment">%h=showLayers(gr,STRTHD,well,'Countrywide model');</span>
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.13<br></p></div><!--
##### SOURCE BEGIN #####
%% Script NHI (netherlands hydrologic instrument)
% This script extracTs the data from the NHI ASCII files that are locally stored in
% directory mfLab/examples/NHI/NHIascii. These files on their turn were obtained
% thoungh unzipping the files in mfLab/examples/NHI/NHIzipfiles. The zipfiles
% were downloaded from the official NHI site (www.NHI.nu/bibliotheek).

%% The NHI files
% These NHI files consitute the cell-based data of the national hydrologic
% instrument, a currently 7 aquifer and 6 aquitard nation-wide finite
% difference groundwater (and surface water) model. The exent of the model
% is 1200 by 1300 cells with constant cell resolution 250 by to 250 m.
%
% This script,
mfilename
%%
% reads the ASCII files and saves them as MATLAB mat files to gain maximum
% speed in later usage while using least diskspace.
% The total size of the ASCII files so reduces to around 250 Mb.
% To my knowledge this is the most efficient way of storage we can get.
%
% The stored files are generally either 3D arrays of some parameter or
% cell-based lists specifying stresses for the MODFLOW model. The stresses
% are for the WEL, GHB, RIV and the DRN package.
%
% The data for the 3D arrays are provided in separate file, one for each layer
% and contained in one or more zip files.
%
% Some special care had to be taken with respect to the elevations of the
% tops and bottoms of the layers. The top is contained in the AHN file, the
% "Algemene Hoogtekaart Nederland" (General Elevation MAP (or DEM) of the
% Netherlands). The elevations in it are given in m units above national
% datum (NAP), while all other layer-top and bottom elevations are given in cm.
%
% Anisotropy, necessary to model the ice-pushed formations in the center of the
% Netherlands is defined through an anisotropy factor and the angle of the
% direction of the main anisotropy axis with respect to the North
% (clockwise positive). Anioatropy may be neglected when modeling parts
% without it.
%
% The files do not contain basic data, but just the derived data
% values per model cell. There is one exception: The WEL list also
% contains the actual x,y coordinates of wells and their extraction.
% The extraction is some long-term average value (details to be looked up).
%
% The Excel workbook mflab/examples/NHI/NHI.xls lists all zip files and the
% ASCII files as well as their translation to the mat files
% generated from them. When the NHI model is renewed, the zip files have to be
% reloaded and this workbook may have to be updated as well. Currently, the
% entire model consists of about 120 ascii files.
%
% The NHI site and the NHI documentation on that site lack a descripition
% of all the individual files. This makes it hard to figure out what
% exactly is their contents, and even more so, how the files have been
% generated and how to interpret them correctly. It is the ambition to find
% out, so that their description can be added to the workbook HNI.xls for
% reference.
%
% Finally, note that the data provided by www.NHI.nu are only steady-state
% data. There are no dynamic stress period data available at this time.
% Exact 3D data on the subsurface salinity distribution are also lacking.
% I will do my best to use the 3D salinity data of the Deltares institute
% model for South-Holland, which covers about half the country.
% When the 3D data become available, it will be downloaded and will
% replace the South-Holland data.
%
% The current data set was downloaded around early April 2012.
%
% TO 120808

%% Variable types for layer processing
% Each varialble will be given a type that will be stored along with the
% variable in the matfile, to facilitate handling the variable when reloaded
% later on. The possible type so far are

varTypes = {
    '3Dlay';           % a 3D array size of model (Ny,Nx,NLay)
    '3Dcbd';           % 2 3D array size of confining beds (Ny,Nz,Ncbd)
    '3Dtime';          % a 2D-time array, e.g. recharge (Ny,Nx,Nt)
    'gridObj';         % a matlab grid object
    'wellObj';         % an array of mflab well objects
    'wellSeriesObj';   % an array of mflab well series objects
    'struct';          % a struct like ZETA
    'stress';          % a stres (GHB, RIV, ..) i.e. [it iz iy ix values]
    'zlist'            % one value per layer list such as wettability
    };

%% Setting up the directories and basename
% Basename used for this directory and the workbook with the file names
basename  = 'NHI';

%%
% Path to NHI dir, adapt for your personal computer
NHIdir  = '/Users/Theo/GRWMODELS/mflab/examples/NHI/';

asciiFilesDir  = 'NHIascii';    % name of subdirectory with NHI ascii files
datadir        = 'NHIdata';     % name of subdirectory with the NHI mat files
sheetNm        = 'files';       % name of worksheet in <<basename>>.xls with names of zipped and ascii files
columnHdr      = 'variable';    % name of column in <<sheetNm>> with MODFLOW variable name connected to ascii file

%%
% Inform user
fmt = '%56s = %s\n';
fprintf(fmt,'basename',basename);
fprintf(fmt,'subdirectory with NHI ascii files',NHIdir);
fprintf(fmt,'subdirectory with NHI mat files',datadir);
fprintf(fmt,'workshee with NHI ascii file names',sheetNm);
fprintf(fmt,'column naming the model variable or resulting mat file',columnHdr);

%% Change to NHIdir directory
eval(['cd ' NHIdir]);

%% Determine the number of NHI layers automatically
% The number of NHI layers equals the number of aquifers, taken from the files starting with kD
Nlay = length(dir(fullfile(asciiFilesDir,'KD*.ASC')));
fprintf(fmt,'The number of model layers',sprintf('%d',Nlay));

%% Determing the number of confining beds
% All NHI layers (except the last) have a confining bed below them, so we
% skip this by setting LAYCBD immediately as follows
LAYCBD = ones(1,Nlay);

%% Set minimum layer thickness
% Many layers have zero thickness over at least parts of their exent,
% whlile subtraction of the first bottom from the DEM even yields negative
% thickness over part of the area. Therefore, we guarantee a minimum
% thickness as specified by MINDZ here
MINDZ = 0.1;

fprintf(fmt,'LAYCBD','all but the last layers have a confining bed below them');
fprintf(fmt,'MINDZ: Minimum layer thickness used in NHI.\n',MINDZ);

%% Get meta data for cell-arrays
% Every ASCII file specifying some layer variable such as KD1.ASC contains
% meta data concerning the extent of the grid end its lower left coordinate
% in the national Dutch system ("Rijksdriehoeksmeting"). Note that conversion
% between the national x,y and the international WGS84 system used by Google
% can be done within mfLab using the WGS2RD and RD2WGS functions.
% Here we read out the meta data, using the ASCII file KD1.ASC for the
% purpose.

fid = fopen(fullfile(asciiFilesDir,'KD1.ASC'),'r');
    meta = getNHImeta(fid);
fclose(fid);

%% Compute grid-line coordinates for NHI based on meta data just obtained
% The cell center coordinates follow from the grid line coordinates and the
% cell size. We don't need them, because we will use mfLab's  grid object later
% on for all coordinate work.

fprintf('Computing the NHI grid line coordinates from NHI meta data.\n');

xGrNHI = meta.XLLCORNER+(0:+1:meta.NCOLS)*meta.CELLSIZE;
yGrNHI = meta.YLLCORNER+(meta.NROWS:-1:0)*meta.CELLSIZE;

%%
% Compute the indices of the model. Subsets may be used in functions
% applied further down to select data for a submodel.

Ix= 1:meta.NCOLS;  fprintf('Number of columns in NHI = %d\n',meta.NCOLS);
Iy= 1:meta.NROWS;  fprintf('Number of rows    in NHI = %d\n',meta.NROWS);

%% Get the actual data and save them into mat files in the data directory
% To generate the mat files for cell layer variables such as transmmissivity
% and elevations, we have to read out the ascii file of each layer and join
% them in a 3D MATLAB array. In the process we may rename the variable to
% a more international standard, like TRAN instead of kD, and we may
% convert the variable as required by MODFLOW, such as VCONT instead of C.
% Instead of separate 3D files of the tops and the bottoms of all layers,
% we use Z, which is a sequence of layer interface planes, starting at
% ground surface and ending at the bottom of the model, which combines both
% the aquifer-layers and the aquitard confining beds.

%% Get transmissivities
[TRAN,NHIvars.TRAN]  = makeArray(basename,sheetNm,asciiFilesDir,columnHdr,'TRAN',Ix,Iy);
TRANtype = '3Dlay';
save(fullfile(NHIdir,datadir,'TRAN'),'TRAN','TRANtype');

%% Vertical hydraulic resistance of confining beds
% In the Netherlands we always characterize the hydraulic vertical
% conductance combined with the thickness by their total hydraulic
% resistance, which equals c=DZ/kv (time]. In the USA and MOFLOW VCONT is used in
% stead, which is kv/DZ [1/time]. Therefore there is no fundamental difference
% between using one or the other. As the www.NHI.nu site publishes the
% c-values we will use them as well and take the reciprocal whenever we
% need them in MODFLOW later on.
%
[C NHIvars.C] = makeArray(basename,sheetNm,asciiFilesDir,columnHdr,'C',Ix,Iy');
Ctype = '3Dlay';
save(fullfile(NHIdir,datadir,'C'),'C','Ctype');

%% Starting heads
% Although not strictly necessary for steady-state models, unless used for
% fixed heads, we will still use the starting heads to initalize the the solver.
% This starts the convergence as closely as possible to the final results.
[STRTHD NHIvars.STRTHD]  = makeArray(basename,sheetNm,asciiFilesDir,columnHdr,'STRTHD',Ix,Iy);
STRTHDtype = '3Dlay';
save(fullfile(NHIdir,datadir,'STRTHD'),'STRTHD','STRTHDtype');

%% Cell-based recharge
% The NHI site gives one ASCII cell-based file for the net recharge. It
% must be some properly chosen long-term average value, which does not
% become clear from the site. The exact origin is still to be requested
% from the developers.
% The recharge is a 2D matrix. There is no need to generate a 3D array from
% it.
[fname NHIvars.RECH] = getNHIfileNm(basename,sheetNm,columnHdr,'RECH'); 
RECH     = getNHIASC(fullfile(asciiFilesDir,fname),Ix,Iy);
RECHtype = '3Dtime';

save(fullfile(NHIdir,datadir,'RECH'),'RECH','RECHtype');

%% Elevation of all layers and model grid object

%%
% Get layer top and bottom elevations of layers and aquitards
[Z NHIvars.Z] = makeArray(basename,sheetNm,asciiFilesDir,columnHdr,'Z',Ix,Iy);

%%
% Convert all Z(:,:,2:end) from cm to m, except Z1 = groundsurface which is
% already in m above datum
Z(:,:,2:end)=Z(:,:,2:end)/100;

%%
% Remove the NaNs of internal surface waters in AHN
% The AHN DEM contains nodata where surface water is present. For any model
% use we need proper elevation data here as well. We obtain these data by
% replacing the NaNs in the ASCII file by corresponding values of Z(:,:,2),
% the second layer, i.e. the bottom of the first model layer. Note that
% zero thickness that are the consequence of this procedure will be
% eleminated next.

z2=Z(:,:,2); % second plane

%%
% list of indices in the first layer correspond to second loose layer
Z(isnan(Z(:,:,1)))=z2(isnan(Z(:,:,1)));

%%
% Make sure that bottoms are at or below tops of layers working downward.
for i=2:size(Z,3)
    dz = max(diff(Z(:,:,[i i-1]),1,3),MINDZ);
    Z(:,:,i)=Z(:,:,i-1)-dz; 
end

%%
% Verify that each laye ris below its top. To do this, get DZ and and compute
% the minimum thickness of each layer.
DZ= abs(diff(Z,1,3));
for iz=1:size(DZ,3);
    fprintf('Thickness DZ of layer %2d varies between %12.3f and%12.3f\n',...
        iz,min(min(DZ(:,:,iz))),max(max(DZ(:,:,iz))));
end

%% 
% save Z
Ztype = '3Dlay';
save(fullfile(NHIdir,datadir,'Z'),'Z','Ztype');

%% Generate the mfLab grid object:
% The mfLab grid object contains all grid data and the methods to deal with
% them. It is a key object in mfLab. So create it:
gr= gridObj(xGrNHI,yGrNHI,Z,LAYCBD,MINDZ);
NHIvars.gr ={ 'gr' 'noFile' 'nozip' 'generated NHI grid' };

%%
% Save the grid
GRIDtype = 'gridObj';
save(fullfile(NHIdir,datadir,'gr'),'gr','GRIDtype');

%% Stresses
% Next, the stresses are read and stored. The stresses comprise the wells,
% and the data lists for the general head-boundary package (GHB), the drain
% package (DRN) the river package (RIV) and possibly other packages such as
% the drains with return flow (DRT), the changing head package (CHD) and
% the steam-routing package (STR). However, until now NHI only uses WEL, DRN,
% GHB and RIV packages.
% The stress packages are lists with one line per model cell. A list possibly
% contains hundreds of thousands of lines, each of which specifies the
% indices of the position of the cell in the grid and its data.
% Processing may, therefore, take same more time, although it is not generally
% overwhelming.
%
% When reading the stresses we have to consider the indices of the current grid,
% which are, in the case we select a submodel, a subset of all indices,
% requiring renumbering of the indices on every line of each of the stress lists.
% This renumbmering is done here to remain general. If the total model is
% selected, then renumbering has no effect.

%% Get the stresses for the RIV package (surface water)
% The NHI site gives several files for this package.Each refers to a different
% level of the represented surface water in the cells in a hierarchical
% surface-water ranking system. There are also files for different seasons,
% i.e. winter and summer and year-average files. We will only use the
% year-average files here at this time.
fprintf('Getting RIV for interaction with main, primary, secondary and tertiary surface water.\n');
[RIV0 NHIvars.RIV0] = getNHIBCN({'RIVHMY'  'RIVCM'  'RIVBMY' },basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
[RIV1 NHIvars.RIV1] = getNHIBCN({'RIVHP1Y' 'RIVCP1' 'RIVBP1Y'},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
[RIV2 NHIvars.RIV2] = getNHIBCN({'RIVHS1Y' 'RIVCS1' 'RIVBS1Y'},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
[RIV3 NHIvars.RIV3] = getNHIBCN({'RIVHT1Y' 'RIVCT1' 'RIVBT1Y'},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);

%%
% Put RIV into the layer that agrees with the corresponding depth of the cell bottom:
RIV0=setRIVdepth(RIV0,Z,gr.LAYCBD);
RIV1=setRIVdepth(RIV1,Z,gr.LAYCBD);
RIV2=setRIVdepth(RIV2,Z,gr.LAYCBD);
RIV3=setRIVdepth(RIV3,Z,gr.LAYCBD);

RIV0type = 'stress';
RIV1type = 'stress';
RIV2type = 'stress';
RIV3type = 'stress';
save(fullfile(NHIdir,datadir,'RIV0'),'RIV0','RIV0type');
save(fullfile(NHIdir,datadir,'RIV1'),'RIV1','RIV1type');
save(fullfile(NHIdir,datadir,'RIV2'),'RIV2','RIV2type');
save(fullfile(NHIdir,datadir,'RIV3'),'RIV3','RIV3type');

%% Get the stresses for the general head package (GHB)
% The structure of the files is as described before for the RIV
% package. The files hereafter are used to set the infiltration
% resistance. This is to differenciate infiltration resistance
% from drainage resistance.
% Therefore, RIV is used to extract the corresponding heads.
fprintf('Getting GHB to be used for infiltration resistances:\n');
[GHB0 NHIvars.GHB0] = getNHIBCN({'RIVHMY'  'GHBCM' },basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
[GHB1 NHIvars.GHB1] = getNHIBCN({'RIVHP1Y' 'GHBCP1'},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
[GHB2 NHIvars.GHB2] = getNHIBCN({'RIVHS1Y' 'GHBCS1'},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);

GHB0type = 'stress';
GHB1type = 'stress';
GHB2type = 'stress';
save(fullfile(NHIdir,datadir,'GHB0'),'GHB0','GHB0type');
save(fullfile(NHIdir,datadir,'GHB1'),'GHB1','GHB1type');
save(fullfile(NHIdir,datadir,'GHB2'),'GHB2','GHB2type');

%% Get the stresses for the drain package (DRN)
% The NHI model uses the drain package to specify tile drainage only.
[DRN NHIvars.DRN]  = getNHIBCN({'DRNH' 'DRNC'},basename,sheetNm,columnHdr,asciiFilesDir,Ix,Iy);
DRNtype = 'stress';
save(fullfile(NHIdir,datadir,'DRN'),'DRN','DRNtype');

%% Get the wells (WEL)
% The NHI well file is special in that it contains two types of wells. The
% lines beyond about 3000 have as a comment
% the word 'SUR'. I, therefore, named these wells 'SURwells'.
% Plotting the surwells on a map reveals that they fully cover certain areas
% in the south-eastern part of the Netherlands. So presmumably these wells
% are irrigation wells, used to irrigate land from local groudwater.
% They are also shallow.
% The first about 3000 lines concern regulary wells, generally those
% of the drinking-water companies and industries. These wells are most often
% deeper, with screens in semi-confined aquifers. Each line of these wells
% contains further details, namely the actual well-specific data, among
% which are its x,y location and its actual extraction. More than one well may
% reside in a single cell, as MODFLOW will simply add them. This way the
% true well data are contained in the NHI well file.
%
% When reading the well file, a separate array of mflab well objects is
% generated with the actual
% well data. This array can be used with any model and submodel without the
% wel file list, as the latter is specific to the grid of the NHI groundwater
% model.
% Each of the lines in the regular wells also has a decrete value of the
% local transmmissivity. This too may be very useful for further modeling. A
% special transmissivy object array is also generated during the while
% reading and processing the well file.

%%
% First get well-file name
[fname names] = getNHIfileNm(basename,sheetNm,columnHdr,'WELL'); 

%% Get wells.
% Note that surwells(=irrigation wells?) are special, kD is at well sites.
% * well is the array of well objects
% * surwell is the array of surwell objects
% * kD is the array of transmissivit objects
% * WEL is the well list such as is processed by the MODFLOW's well
% package.
[well,surwell,kD,WEL] = getNHISCD(gr,fullfile(asciiFilesDir,fname),Ix,Iy);

NHIvars.WEL     = names;
NHIvars.well    = NHIvars.WEL;
NHIvars.surwell = NHIvars.WEL;
NHIvars.kD      = NHIvars.WEL;

welltype    = 'wellObj';
surwelltype = 'wellObj';
kDtype      = 'kDObj';
WELtype     = 'stress';
save(fullfile(NHIdir,datadir,'well'),'well','welltype');
save(fullfile(NHIdir,datadir,'surwell'),'surwell','surwelltype');
save(fullfile(NHIdir,datadir,'kDobj'),'kD','kDtype');
save(fullfile(NHIdir,datadir,'WEL'),'WEL','WELtype');

%% Done
fprintf('\n');
fprintf('All NHI data are saved as matfiles in the directory   <<%s>>\n',fullfile(NHIdir,datadir,''));
fprintf('File and variable names are in Excel workbook         <<%s>>\n',fullfile(NHIdir,[basename '.xls']));

%% Save the struct whit the names of the saved variables
NHIvarstype = 'vars';
save(fullfile(NHIdata,'NHIvars'),'NHIvars','NHIvarstype');

%% TODO:
% * Verification
% * Viewing
%
%% Show STRTHD in 3D
% For any part of the model coutour this part using indces and put this in
% a new grid (see how this in done in extactFromNHI.m in the example directories
% may be too big to show on smaller PCs

%h=showLayers(gr,STRTHD,well,'Countrywide model');

##### SOURCE END #####
--></body></html>